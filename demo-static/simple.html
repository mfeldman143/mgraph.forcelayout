<!DOCTYPE html>
<html>
<head>
    <title>mgraph.forcelayout Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        svg { border: 1px solid #ccc; background: white; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ mgraph.forcelayout Test</h1>
        <div id="status">Loading...</div>
        <svg width="600" height="400" id="graph"></svg>
        <div id="info"></div>
    </div>

    <script src="../dist/mgraph.forcelayout.umd.js"></script>
    <script>
        const statusDiv = document.getElementById('status');
        const infoDiv = document.getElementById('info');
        
        console.log('statusDiv:', statusDiv);
        console.log('infoDiv:', infoDiv);
        
        if (!statusDiv || !infoDiv) {
            console.error('Missing DOM elements!');
            document.body.innerHTML = '<h1>Error: Missing DOM elements</h1>';
        }
        
        try {
            statusDiv.innerHTML = '<div class="status">Checking mgraph.forcelayout...</div>';
            console.log('mgraphCreateLayout:', mgraphCreateLayout);
            
            if (typeof mgraphCreateLayout === 'undefined') {
                throw new Error('mgraphCreateLayout not found');
            }
            
            // Create a simple test graph manually
            const graph = {
                nodes: [
                    { id: 0 }, { id: 1 }, { id: 2 }, { id: 3 }, { id: 4 }
                ],
                links: [
                    { fromId: 0, toId: 1, id: 'link1' },
                    { fromId: 1, toId: 2, id: 'link2' },
                    { fromId: 2, toId: 3, id: 'link3' },
                    { fromId: 3, toId: 4, id: 'link4' },
                    { fromId: 4, toId: 0, id: 'link5' },
                    { fromId: 0, toId: 2, id: 'link6' }
                ],
                forEachNode: function(fn) { this.nodes.forEach(fn); },
                forEachLink: function(fn) { this.links.forEach(fn); },
                getNodesCount: function() { return this.nodes.length; },
                getLinksCount: function() { return this.links.length; },
                getNode: function(id) { return this.nodes.find(n => n.id === id); },
                getLinks: function(nodeId) { 
                    return this.links.filter(l => l.fromId === nodeId || l.toId === nodeId); 
                },
                on: function() {}, // Mock event handler
                off: function() {} // Mock event handler
            };

            statusDiv.innerHTML = '<div class="status">Creating layout...</div>';
            
            // Use the global directly (no .default needed)
            const layout = mgraphCreateLayout(graph);
            
            statusDiv.innerHTML = '<div class="status">Running simulation...</div>';
            // Run simulation
            for (let i = 0; i < 200; i++) {
                layout.step();
            }
            
            const svg = document.getElementById('graph');
            
            // Get bounds for centering
            const rect = layout.getGraphRect();
            const centerX = 300;
            const centerY = 200;
            const scale = 50;
            
            statusDiv.innerHTML = '<div class="status success">‚úÖ Success! Drawing graph...</div>';
            
            // Draw links first (so they appear behind nodes)
            graph.forEachLink(link => {
                const from = layout.getNodePosition(link.fromId);
                const to = layout.getNodePosition(link.toId);
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', from.x * scale + centerX);
                line.setAttribute('y1', from.y * scale + centerY);
                line.setAttribute('x2', to.x * scale + centerX);
                line.setAttribute('y2', to.y * scale + centerY);
                line.setAttribute('stroke', '#666');
                line.setAttribute('stroke-width', '2');
                svg.appendChild(line);
            });
            
            // Draw nodes
            graph.forEachNode(node => {
                const pos = layout.getNodePosition(node.id);
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', pos.x * scale + centerX);
                circle.setAttribute('cy', pos.y * scale + centerY);
                circle.setAttribute('r', 8);
                circle.setAttribute('fill', 'orange');
                circle.setAttribute('stroke', '#333');
                circle.setAttribute('stroke-width', '2');
                svg.appendChild(circle);
                
                // Add node labels
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', pos.x * scale + centerX);
                text.setAttribute('y', pos.y * scale + centerY + 4);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '12');
                text.setAttribute('font-weight', 'bold');
                text.textContent = node.id;
                svg.appendChild(text);
            });
            
            infoDiv.innerHTML = `
                <h3>üéâ Success! Graph Statistics:</h3>
                <ul>
                    <li><strong>Nodes:</strong> ${graph.getNodesCount()}</li>
                    <li><strong>Links:</strong> ${graph.getLinksCount()}</li>
                    <li><strong>Graph bounds:</strong> ${JSON.stringify(rect)}</li>
                    <li><strong>Simulator available:</strong> ${typeof mgraphCreateLayout.simulator === 'function' ? '‚úÖ Yes' : '‚ùå No'}</li>
                </ul>
                <p><strong>üéâ mgraph.forcelayout UMD build is working perfectly!</strong></p>
            `;
            
        } catch (error) {
            if (statusDiv) {
                statusDiv.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
            }
            console.error('Demo error:', error);
        }
    </script>
</body>
</html>